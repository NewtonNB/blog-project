<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog CRUD App - React</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Playfair+Display:wght@700;800&display=swap" rel="stylesheet">
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel Standalone for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Axios for API calls -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        h1, h2, h3 {
            font-family: 'Playfair Display', serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #374151;
        }

        input, textarea, select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .input-error {
            border-color: #dc2626 !important;
        }

        .error-message {
            color: #dc2626;
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-danger {
            background: #dc2626;
            color: white;
        }

        .post-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .post-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .post-card:hover {
            transform: translateY(-4px);
        }

        .navbar {
            background: rgba(255, 255, 255, 0.95);
            padding: 1rem 2rem;
            border-radius: 16px;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .success-message {
            background: #f0fdf4;
            border: 2px solid #86efac;
            color: #16a34a;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1rem;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #6b7280;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // API Configuration
        const API_URL = 'http://127.0.0.1:8000/api';
        
        // Axios instance
        const api = axios.create({
            baseURL: API_URL,
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            }
        });

        // Add token to requests
        api.interceptors.request.use(config => {
            const token = localStorage.getItem('token');
            if (token) {
                config.headers.Authorization = `Bearer ${token}`;
            }
            return config;
        });

        // Main App Component
        function App() {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('login');
            const [loading, setLoading] = useState(false);

            useEffect(() => {
                const token = localStorage.getItem('token');
                const userData = localStorage.getItem('user');
                if (token && userData) {
                    setUser(JSON.parse(userData));
                    setView('posts');
                }
            }, []);

            const handleLogout = () => {
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                setUser(null);
                setView('login');
            };

            return (
                <div className="container">
                    {user && (
                        <div className="navbar">
                            <h2>Blog CRUD App</h2>
                            <div>
                                <button className="btn btn-secondary" onClick={() => setView('posts')} style={{marginRight: '1rem'}}>
                                    Posts
                                </button>
                                <button className="btn btn-secondary" onClick={() => setView('create')} style={{marginRight: '1rem'}}>
                                    Create Post
                                </button>
                                <button className="btn btn-danger" onClick={handleLogout}>
                                    Logout
                                </button>
                            </div>
                        </div>
                    )}

                    {!user && view === 'login' && <LoginForm setUser={setUser} setView={setView} />}
                    {!user && view === 'register' && <RegisterForm setView={setView} />}
                    {!user && view === 'verify-otp' && <VerifyOTPForm setUser={setUser} setView={setView} />}
                    {user && view === 'posts' && <PostsList setView={setView} />}
                    {user && view === 'create' && <CreatePostForm setView={setView} />}
                    {user && view === 'edit' && <EditPostForm setView={setView} />}
                </div>
            );
        }

        // Login Form Component
        function LoginForm({ setUser, setView }) {
            const [formData, setFormData] = useState({
                email: 'tukamuhebwanewton@gmail.com',
                password: 'password123'
            });
            const [errors, setErrors] = useState({});
            const [message, setMessage] = useState('');
            const [loading, setLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                setErrors({});
                setMessage('');

                try {
                    const response = await api.post('/auth/login', formData);
                    if (response.data.success) {
                        localStorage.setItem('token', response.data.data.token);
                        localStorage.setItem('user', JSON.stringify(response.data.data.user));
                        setUser(response.data.data.user);
                        setMessage('Login successful!');
                    }
                } catch (error) {
                    if (error.response?.data?.errors) {
                        setErrors(error.response.data.errors);
                    } else {
                        setMessage(error.response?.data?.message || 'Login failed');
                    }
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="card" style={{maxWidth: '500px', margin: '0 auto'}}>
                    <h1>Login</h1>
                    {message && <div className={message.includes('successful') ? 'success-message' : 'error-message'}>{message}</div>}
                    
                    <form onSubmit={handleSubmit}>
                        <div className="form-group">
                            <label>Email</label>
                            <input
                                type="email"
                                value={formData.email}
                                onChange={(e) => setFormData({...formData, email: e.target.value})}
                                className={errors.email ? 'input-error' : ''}
                            />
                            {errors.email && <div className="error-message">{errors.email[0]}</div>}
                        </div>

                        <div className="form-group">
                            <label>Password</label>
                            <input
                                type="password"
                                value={formData.password}
                                onChange={(e) => setFormData({...formData, password: e.target.value})}
                                className={errors.password ? 'input-error' : ''}
                            />
                            {errors.password && <div className="error-message">{errors.password[0]}</div>}
                        </div>

                        <button type="submit" className="btn btn-primary" disabled={loading} style={{width: '100%'}}>
                            {loading ? 'Logging in...' : 'Login'}
                        </button>
                    </form>

                    <p style={{marginTop: '1rem', textAlign: 'center'}}>
                        Don't have an account? <a href="#" onClick={() => setView('register')} style={{color: '#667eea'}}>Register</a>
                    </p>
                </div>
            );
        }

        // Register Form Component
        function RegisterForm({ setView }) {
            const [formData, setFormData] = useState({
                name: '',
                email: '',
                phone: '',
                password: '',
                password_confirmation: ''
            });
            const [errors, setErrors] = useState({});
            const [message, setMessage] = useState('');
            const [loading, setLoading] = useState(false);
            const [registeredEmail, setRegisteredEmail] = useState('');

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                setErrors({});
                setMessage('');

                try {
                    const response = await api.post('/auth/register', formData);
                    if (response.data.success) {
                        setMessage(response.data.message);
                        setRegisteredEmail(formData.email);
                        setTimeout(() => {
                            localStorage.setItem('verify_email', formData.email);
                            setView('verify-otp');
                        }, 2000);
                    }
                } catch (error) {
                    if (error.response?.data?.errors) {
                        setErrors(error.response.data.errors);
                    } else {
                        setMessage(error.response?.data?.message || 'Registration failed');
                    }
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="card" style={{maxWidth: '500px', margin: '0 auto'}}>
                    <h1>Register</h1>
                    {message && <div className={message.includes('successful') ? 'success-message' : 'error-message'}>{message}</div>}
                    
                    <form onSubmit={handleSubmit}>
                        <div className="form-group">
                            <label>Name</label>
                            <input
                                type="text"
                                value={formData.name}
                                onChange={(e) => setFormData({...formData, name: e.target.value})}
                                className={errors.name ? 'input-error' : ''}
                            />
                            {errors.name && <div className="error-message">{errors.name[0]}</div>}
                        </div>

                        <div className="form-group">
                            <label>Email</label>
                            <input
                                type="email"
                                value={formData.email}
                                onChange={(e) => setFormData({...formData, email: e.target.value})}
                                className={errors.email ? 'input-error' : ''}
                            />
                            {errors.email && <div className="error-message">{errors.email[0]}</div>}
                        </div>

                        <div className="form-group">
                            <label>Phone (with country code)</label>
                            <input
                                type="tel"
                                placeholder="+256 700 123 456"
                                value={formData.phone}
                                onChange={(e) => setFormData({...formData, phone: e.target.value})}
                                className={errors.phone ? 'input-error' : ''}
                            />
                            {errors.phone && <div className="error-message">{errors.phone[0]}</div>}
                        </div>

                        <div className="form-group">
                            <label>Password</label>
                            <input
                                type="password"
                                value={formData.password}
                                onChange={(e) => setFormData({...formData, password: e.target.value})}
                                className={errors.password ? 'input-error' : ''}
                            />
                            {errors.password && <div className="error-message">{errors.password[0]}</div>}
                        </div>

                        <div className="form-group">
                            <label>Confirm Password</label>
                            <input
                                type="password"
                                value={formData.password_confirmation}
                                onChange={(e) => setFormData({...formData, password_confirmation: e.target.value})}
                            />
                        </div>

                        <button type="submit" className="btn btn-primary" disabled={loading} style={{width: '100%'}}>
                            {loading ? 'Registering...' : 'Register'}
                        </button>
                    </form>

                    <p style={{marginTop: '1rem', textAlign: 'center'}}>
                        Already have an account? <a href="#" onClick={() => setView('login')} style={{color: '#667eea'}}>Login</a>
                    </p>
                </div>
            );
        }

        // Verify OTP Component
        function VerifyOTPForm({ setUser, setView }) {
            const [otpCode, setOtpCode] = useState('');
            const [email, setEmail] = useState(localStorage.getItem('verify_email') || '');
            const [errors, setErrors] = useState({});
            const [message, setMessage] = useState('');
            const [loading, setLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                setErrors({});
                setMessage('');

                try {
                    const response = await api.post('/auth/verify-otp', {
                        email,
                        otp_code: otpCode
                    });
                    if (response.data.success) {
                        setMessage(response.data.message);
                        setTimeout(() => {
                            localStorage.removeItem('verify_email');
                            setView('login');
                        }, 2000);
                    }
                } catch (error) {
                    if (error.response?.data?.errors) {
                        setErrors(error.response.data.errors);
                    } else {
                        setMessage(error.response?.data?.message || 'Verification failed');
                    }
                } finally {
                    setLoading(false);
                }
            };

            const handleResend = async () => {
                setLoading(true);
                try {
                    const response = await api.post('/auth/resend-verification', { email });
                    setMessage(response.data.message);
                } catch (error) {
                    setMessage(error.response?.data?.message || 'Failed to resend code');
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="card" style={{maxWidth: '500px', margin: '0 auto'}}>
                    <h1>Verify Email</h1>
                    <p style={{marginBottom: '1rem', color: '#6b7280'}}>
                        Enter the 6-digit code sent to your email
                    </p>
                    {message && <div className={message.includes('successful') ? 'success-message' : 'error-message'}>{message}</div>}
                    
                    <form onSubmit={handleSubmit}>
                        <div className="form-group">
                            <label>Email</label>
                            <input
                                type="email"
                                value={email}
                                onChange={(e) => setEmail(e.target.value)}
                                readOnly
                            />
                        </div>

                        <div className="form-group">
                            <label>OTP Code</label>
                            <input
                                type="text"
                                maxLength="6"
                                placeholder="123456"
                                value={otpCode}
                                onChange={(e) => setOtpCode(e.target.value.replace(/\D/g, ''))}
                                className={errors.otp_code ? 'input-error' : ''}
                                style={{fontSize: '1.5rem', textAlign: 'center', letterSpacing: '0.5rem'}}
                            />
                            {errors.otp_code && <div className="error-message">{errors.otp_code[0]}</div>}
                        </div>

                        <button type="submit" className="btn btn-primary" disabled={loading} style={{width: '100%', marginBottom: '1rem'}}>
                            {loading ? 'Verifying...' : 'Verify'}
                        </button>

                        <button type="button" className="btn btn-secondary" onClick={handleResend} disabled={loading} style={{width: '100%'}}>
                            Resend Code
                        </button>
                    </form>
                </div>
            );
        }

        // Posts List Component
        function PostsList({ setView }) {
            const [posts, setPosts] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                fetchPosts();
            }, []);

            const fetchPosts = async () => {
                try {
                    const response = await api.get('/posts');
                    setPosts(response.data.data || []);
                } catch (error) {
                    console.error('Failed to fetch posts:', error);
                } finally {
                    setLoading(false);
                }
            };

            const handleDelete = async (slug) => {
                if (!confirm('Are you sure you want to delete this post?')) return;

                try {
                    await api.delete(`/posts/${slug}`);
                    fetchPosts();
                } catch (error) {
                    alert('Failed to delete post');
                }
            };

            if (loading) return <div className="loading">Loading posts...</div>;

            return (
                <div className="card">
                    <h1>Blog Posts</h1>
                    <div className="post-grid">
                        {posts.map(post => (
                            <div key={post.id} className="post-card">
                                <h3>{post.title}</h3>
                                <p style={{color: '#6b7280', fontSize: '0.875rem', marginBottom: '0.5rem'}}>
                                    {post.category?.name} â€¢ {post.user?.name}
                                </p>
                                <p style={{marginBottom: '1rem'}}>{post.excerpt}</p>
                                <div style={{display: 'flex', gap: '0.5rem'}}>
                                    <button className="btn btn-secondary" style={{flex: 1}}>
                                        Edit
                                    </button>
                                    <button className="btn btn-danger" onClick={() => handleDelete(post.slug)} style={{flex: 1}}>
                                        Delete
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        // Create Post Form Component
        function CreatePostForm({ setView }) {
            const [formData, setFormData] = useState({
                title: '',
                content: '',
                excerpt: '',
                category_id: '1',
                status: 'published'
            });
            const [errors, setErrors] = useState({});
            const [message, setMessage] = useState('');
            const [loading, setLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                setErrors({});
                setMessage('');

                try {
                    const response = await api.post('/posts', formData);
                    if (response.data.success) {
                        setMessage('Post created successfully!');
                        setTimeout(() => setView('posts'), 2000);
                    }
                } catch (error) {
                    if (error.response?.data?.errors) {
                        setErrors(error.response.data.errors);
                    } else {
                        setMessage(error.response?.data?.message || 'Failed to create post');
                    }
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="card">
                    <h1>Create New Post</h1>
                    {message && <div className={message.includes('success') ? 'success-message' : 'error-message'}>{message}</div>}
                    
                    <form onSubmit={handleSubmit}>
                        <div className="form-group">
                            <label>Title</label>
                            <input
                                type="text"
                                value={formData.title}
                                onChange={(e) => setFormData({...formData, title: e.target.value})}
                                className={errors.title ? 'input-error' : ''}
                            />
                            {errors.title && <div className="error-message">{errors.title[0]}</div>}
                        </div>

                        <div className="form-group">
                            <label>Excerpt</label>
                            <textarea
                                rows="3"
                                value={formData.excerpt}
                                onChange={(e) => setFormData({...formData, excerpt: e.target.value})}
                                className={errors.excerpt ? 'input-error' : ''}
                            />
                            {errors.excerpt && <div className="error-message">{errors.excerpt[0]}</div>}
                        </div>

                        <div className="form-group">
                            <label>Content</label>
                            <textarea
                                rows="10"
                                value={formData.content}
                                onChange={(e) => setFormData({...formData, content: e.target.value})}
                                className={errors.content ? 'input-error' : ''}
                            />
                            {errors.content && <div className="error-message">{errors.content[0]}</div>}
                        </div>

                        <div className="form-group">
                            <label>Category</label>
                            <select
                                value={formData.category_id}
                                onChange={(e) => setFormData({...formData, category_id: e.target.value})}
                            >
                                <option value="1">Technology</option>
                                <option value="2">Travel</option>
                                <option value="3">Food</option>
                                <option value="4">Lifestyle</option>
                                <option value="5">Business</option>
                            </select>
                        </div>

                        <div className="form-group">
                            <label>Status</label>
                            <select
                                value={formData.status}
                                onChange={(e) => setFormData({...formData, status: e.target.value})}
                            >
                                <option value="published">Published</option>
                                <option value="draft">Draft</option>
                            </select>
                        </div>

                        <div style={{display: 'flex', gap: '1rem'}}>
                            <button type="submit" className="btn btn-primary" disabled={loading} style={{flex: 1}}>
                                {loading ? 'Creating...' : 'Create Post'}
                            </button>
                            <button type="button" className="btn btn-secondary" onClick={() => setView('posts')} style={{flex: 1}}>
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            );
        }

        // Edit Post Form Component (placeholder)
        function EditPostForm({ setView }) {
            return (
                <div className="card">
                    <h1>Edit Post</h1>
                    <p>Edit functionality coming soon...</p>
                    <button className="btn btn-secondary" onClick={() => setView('posts')}>
                        Back to Posts
                    </button>
                </div>
            );
        }

        // Render App
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
